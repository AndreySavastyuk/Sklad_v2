# üîß –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–Ø - –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–Å–¢

## üéØ –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –Ω–∞–π–¥–µ–Ω–∞!

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞**: –í SDK Newland –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ `onScanDataReceived`, –∞ –Ω–µ `onScanResult`!

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π callback –≤ BleScannerManager
**–§–∞–π–ª**: `app/src/main/java/com/example/myprinterapp/scanner/BleScannerManager.kt`

**–î–û (–Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏–π –∫–æ–¥)**:
```kotlin
fun onScanResult(data: String, type: Int) {
    // –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –ù–ò–ö–û–ì–î–ê –Ω–µ –≤—ã–∑—ã–≤–∞–ª—Å—è SDK!
}
```

**–ü–û–°–õ–ï (—Ä–∞–±–æ—á–∏–π –∫–æ–¥)**:
```kotlin
override fun onScanDataReceived(data: String) {
    Timber.d("$TAG: onScanDataReceived –≤—ã–∑–≤–∞–Ω —Å –¥–∞–Ω–Ω—ã–º–∏: $data")
    
    val cleanData = data.trim()
    if (cleanData.isNotEmpty()) {
        Timber.i("$TAG: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: $cleanData")
        
        val scanResult = ScanResult(
            data = cleanData,
            format = BarcodeFormat.QR_CODE,
            timestamp = Clock.System.now().toLocalDateTime(TimeZone.currentSystemDefault()),
            deviceId = _connectedDevice.value?.id,
            isProcessed = false,
            metadata = ScanMetadata(quality = 0.9f, orientation = 0)
        )
        
        // –í–ê–ñ–ù–û: –û–±–Ω–æ–≤–ª—è–µ–º Flow —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
        _scanResult.value = scanResult
        
        Timber.i("$TAG: ScanResult –æ–±–Ω–æ–≤–ª–µ–Ω –≤ Flow: ${scanResult.data}")
        
        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–æ–¥–∏–Ω —Å–∏–≥–Ω–∞–ª)
        try {
            bleManager.beep(2700, 100, 15)
        } catch (e: Exception) {
            Timber.e(e, "$TAG: –û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞")
        }
    }
}
```

### 2. ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –≤ AcceptViewModel
**–§–∞–π–ª**: `app/src/main/java/com/example/myprinterapp/viewmodel/AcceptViewModel.kt`

**–î–æ–±–∞–≤–ª–µ–Ω—ã –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**:
```kotlin
// –ö–†–ò–¢–ò–ß–ù–û: –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
viewModelScope.launch {
    bleScannerManager.scanResult.collect { scanResult ->
        if (scanResult != null) {
            Timber.d("$TAG: –ü–æ–ª—É—á–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç BLE —Å–∫–∞–Ω–µ—Ä–∞: ${scanResult.data}")
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞—Å–∫—É –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º
            if (validateAcceptanceQrMask(scanResult.data)) {
                _scannedValue.value = scanResult.data
                Timber.i("$TAG: QR-–∫–æ–¥ –ø—Ä–∏–Ω—è—Ç –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ${scanResult.data}")
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
                _showQuantityDialog.value = true
                
                // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Å–∫–∞–Ω–µ—Ä–µ
                bleScannerManager.clearScanResult()
            } else {
                Timber.w("$TAG: QR-–∫–æ–¥ –Ω–µ –ø—Ä–æ—à–µ–ª –≤–∞–ª–∏–¥–∞—Ü–∏—é –º–∞—Å–∫–∏: ${scanResult.data}")
                _uiState.value = AcceptUiState.Error("QR-–∫–æ–¥ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç—É –ø—Ä–∏–µ–º–∫–∏")
                
                // –í—Å–µ —Ä–∞–≤–Ω–æ –æ—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                bleScannerManager.clearScanResult()
            }
        }
    }
}
```

### 3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –ª–æ–≥–∏
**–§–∞–π–ª—ã**: `MainActivity.kt`, `AcceptScreen.kt`

**MainActivity.kt**:
```kotlin
// –î–æ–±–∞–≤—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –ª–æ–≥
LaunchedEffect(scanned) {
    android.util.Log.d("MainActivity", "Scanned value changed to: $scanned")
}
```

**AcceptScreen.kt**:
```kotlin
// –û–¢–õ–ê–î–ö–ê: –õ–æ–≥–∏—Ä—É–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
LaunchedEffect(scannedValue) {
    if (scannedValue != null) {
        Log.d("AcceptScreen", "–û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: $scannedValue")
    }
}
```

### 4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è
**–§–∞–π–ª—ã**: `BleScannerManager.kt`, `BleScannerSettingsScreen.kt`

**–¢–µ—Å—Ç–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**:
```kotlin
// –¢–µ—Å—Ç–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ (—É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)
if (com.example.myprinterapp.BuildConfig.DEBUG) {
    Button(
        onClick = {
            viewModel.testScanData("TEST=2024/001=PART-123=Test Part")
        }
    ) {
        Text("–¢–ï–°–¢: –≠–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ")
    }
}
```

## üîç –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —Ç–∞–∫—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ Logcat:

```
D/BleScannerManager: onScanDataReceived –≤—ã–∑–≤–∞–Ω —Å –¥–∞–Ω–Ω—ã–º–∏: –ú–ö001=2024/001=–î–ï–¢–ê–õ–¨-123=–¢–µ—Å—Ç–æ–≤–∞—è –¥–µ—Ç–∞–ª—å
I/BleScannerManager: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: –ú–ö001=2024/001=–î–ï–¢–ê–õ–¨-123=–¢–µ—Å—Ç–æ–≤–∞—è –¥–µ—Ç–∞–ª—å
I/BleScannerManager: ScanResult –æ–±–Ω–æ–≤–ª–µ–Ω –≤ Flow: –ú–ö001=2024/001=–î–ï–¢–ê–õ–¨-123=–¢–µ—Å—Ç–æ–≤–∞—è –¥–µ—Ç–∞–ª—å
D/AcceptViewModel: –ü–æ–ª—É—á–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç BLE —Å–∫–∞–Ω–µ—Ä–∞: –ú–ö001=2024/001=–î–ï–¢–ê–õ–¨-123=–¢–µ—Å—Ç–æ–≤–∞—è –¥–µ—Ç–∞–ª—å
I/AcceptViewModel: QR-–∫–æ–¥ –ø—Ä–∏–Ω—è—Ç –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: –ú–ö001=2024/001=–î–ï–¢–ê–õ–¨-123=–¢–µ—Å—Ç–æ–≤–∞—è –¥–µ—Ç–∞–ª—å
D/MainActivity: Scanned value changed to: –ú–ö001=2024/001=–î–ï–¢–ê–õ–¨-123=–¢–µ—Å—Ç–æ–≤–∞—è –¥–µ—Ç–∞–ª—å
D/AcceptScreen: –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: –ú–ö001=2024/001=–î–ï–¢–ê–õ–¨-123=–¢–µ—Å—Ç–æ–≤–∞—è –¥–µ—Ç–∞–ª—å
```

## üß™ –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –®–∞–≥ 1: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ç–µ—Å—Ç–æ–≤–æ–π –∫–Ω–æ–ø–∫–æ–π
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí BLE –°–∫–∞–Ω–µ—Ä
3. –ù–∞–∂–∞—Ç—å "–¢–ï–°–¢: –≠–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ"
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –õ–æ–≥–∏ –≤ Logcat –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤–µ—Å—å –ø–æ—Ç–æ–∫
5. –ü–µ—Ä–µ–π—Ç–∏ –≤ "–ü—Ä–∏—ë–º–∫–∞ –ø—Ä–æ–¥—É–∫—Ü–∏–∏"
6. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –ü–æ–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º "TEST=2024/001=PART-123=Test Part"

### –®–∞–≥ 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º —Å–∫–∞–Ω–µ—Ä–æ–º
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å Newland BLE —Å–∫–∞–Ω–µ—Ä —á–µ—Ä–µ–∑ —ç–∫—Å–ø—Ä–µ—Å—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ "–ü—Ä–∏—ë–º–∫–∞ –ø—Ä–æ–¥—É–∫—Ü–∏–∏"
3. –û—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥ —Ñ–æ—Ä–º–∞—Ç–∞: `–ê=–ë=–í=–ì`
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –î–∏–∞–ª–æ–≥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
1. –û—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π QR (–Ω–∞–ø—Ä–∏–º–µ—Ä, `–ê=–ë=–í`)
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: QR –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "–Ω–µ –ø—Ä–æ—à–µ–ª –≤–∞–ª–∏–¥–∞—Ü–∏—é –º–∞—Å–∫–∏"

## üìä –°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

- ‚úÖ **–ö–æ–º–ø–∏–ª—è—Ü–∏—è**: –£—Å–ø–µ—à–Ω–æ
- ‚úÖ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ (`onScanResult` ‚Üí `onScanDataReceived`)
- ‚úÖ **–û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –ª–æ–≥–∏**: –î–æ–±–∞–≤–ª–µ–Ω—ã
- ‚úÖ **–¢–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è**: –†–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è QR**: –£–ª—É—á—à–µ–Ω–∞
- ‚úÖ **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

## üéâ –û—Å–Ω–æ–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π callback**: SDK —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç `onScanDataReceived`
2. **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í–µ—Å—å –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è
3. **–£–º–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–µ QR –¥–ª—è –ø—Ä–∏–µ–º–∫–∏
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞**: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ –≤ debug —Ä–µ–∂–∏–º–µ

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!** 

–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –º–µ—Ç–æ–¥–æ–º callback'–∞ –±—ã–ª–∞ –Ω–∞–π–¥–µ–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞. –¢–µ–ø–µ—Ä—å –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –æ—Ç BLE —Å–∫–∞–Ω–µ—Ä–∞ –≤ –æ–∫–Ω–æ –ø—Ä–∏—ë–º–∫–∏.

---
**–î–∞—Ç–∞**: 2024-12-19  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ó–ê–í–ï–†–®–ï–ù–´  
**–ì–ª–∞–≤–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: `onScanResult` ‚Üí `onScanDataReceived` 